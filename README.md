# Bibliography URL linker for Typst

I love [Typst](https://typst.app/). I also love the ability of the LaTeX bibliography style of ACL, my home conference, to make the titles of papers in a bibliography hyperlinks to the URL or DOI specified in the Bibtex entry. See e.g. page 10 of [this paper](https://aclanthology.org/2020.acl-main.463/) to see what I mean.

This package makes it possible to create Typst bibliographies with URL-linked titles as well.

## Usage

```
#import "@local/bib-url-linker:0.1.0": link-bib-urls

... @cite something ... @cite more ...

#let bibsrc = read("custom.bib")
#link-bib-urls(bibsrc)[
  #bibliography("custom.bib", style: "./association-for-computational-linguistics.csl")
]
```

It would be desirable to hide the fact that we are reading the same Bibtex file twice behind a single function call, but code in a Typst package [resolves all filenames relative to the package directory](https://github.com/typst/typst/issues/2126), whereas `custom.bib` and other bibliographies live in the directory of the main Typst source file. We may be able to simplify this once [#971](https://github.com/typst/typst/issues/971) gets addressed.

## CSL considerations

Bib-url-linker uses the standard Typst `#bibliography` command to typeset most of the bibliography. You can, in principle, use any CSL style.

However, in order to get the paper titles replaced by links, you need to modify the CSL style you want to use. In every place where you would usually have the paper title, i.e.

```
<text variable="title" prefix=" " suffix=". "/>
```

or similar, your CSL file now instead needs to print a decorated version of the paper's citation-key (aka "key" in Bibtex):

```
<text variable="citation-key" prefix=" !!BIBENTRY!" suffix="!!. " />
```

You can have more prefix before and suffix after the `!!BIBENTRY!` and `!!`, as in the example, but these magic symbols need to be there so bib-url-linker can find the places in the document where the hyperlinked title needs to be inserted.


## Limitations

- Currently, bib-url-linker works only with a single Bibtex bibliography.


## Alternatives

The current mechanism in bib-url-linker is somewhat heavy-handed: a Typst plugin uses the [biblatex](https://github.com/typst/biblatex) crate to parse the Bibtex file (independently of the normal operations of the `bibliograph` command), and then all occurrences of the magic symbol in the Typst bibliography are replaced by the hyperlinked titles.

It would be great to replace this mechanism by something simpler, but all alternatives that I could think of don't work. Here are some of them:

- Print the URL/DOI using the CSL style, and then use a regex show rule to convert it into a `#link` around the title somehow. This does not work because most URLs contain a colon character (:), and these [cause trouble with Typst regexes](https://github.com/typst/typst/issues/86).
- Make the CSL style output text of the form `#link(url)[title]`. This does not work because the content generated by CSL is not evaluated further by Typst. Also, Typst [does not support show rules for the individual bibliography items](https://github.com/typst/typst/issues/942), which makes it tricky to call `#eval` on them.
- Create a show rule for `#link`. Some CSL styles already generate `#link` elements if a URL/DOI is present in the bib entry - one could consider replacing it with a `#link` whose URL is the same as before, but the text is a link symbol or some such. However, a show rule for a link that generates another link runs into an infinite recursion; Typst made [the deliberate decision](https://github.com/typst/typst/pull/3327) to handle such recursions only for `text` show rules.

